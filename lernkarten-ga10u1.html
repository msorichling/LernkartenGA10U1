<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vokabel-Trainer: Unit 1</title>
    
    <!-- Google Font f√ºr handschriftliche √úberschrift -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600&display=swap" rel="stylesheet">

    <style>
        /* Modernes Blaues Styling */
        :root {
            --color-primary: #1e88e5; /* Helles Blau */
            --color-secondary: #0d47a1; /* Dunkles Blau */
            --color-background: #e3f2fd; /* Sehr helles Blau */
            --color-text: #263238; /* Dunkelgrau */
            --color-success: #43a047; /* Gr√ºn f√ºr Korrekt */
            --color-error: #e53935; /* Rot f√ºr Fehler */
            --color-card-front: #42a5f5; /* Kartenfarbe Vorderseite */
            --color-card-back: #26c6da; /* Kartenfarbe R√ºckseite */
            --shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--color-background) 0%, var(--color-primary) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 550px;
            width: 95%;
            text-align: center;
            margin-top: 5vh;
        }

        /* HANDSCHRIFTLICHE √úBERSCHRIFT */
        .game-title, .menu-title {
            font-family: 'Caveat', cursive;
            font-size: 36px;
            font-weight: 600;
            color: var(--color-secondary);
            margin-bottom: 20px;
            text-align: center; /* Zentrierung */
        }
        
        /* STARTBILDSCHIRM STYLING */
        #menu-screen {
            padding: 30px;
            max-width: 600px;
            width: 95%;
            margin-top: 10vh;
            background: white; 
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .menu-button {
            width: 100%;
            background-color: var(--color-background);
            color: var(--color-secondary);
            border: 2px solid var(--color-primary);
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .menu-button:hover {
            background-color: var(--color-primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Fortschrittsanzeige */
        #progressText {
            font-weight: 500;
            color: var(--color-text);
            margin-bottom: 5px;
        }
        
        #attemptCount {
            font-weight: bold;
            color: var(--color-error);
            margin-bottom: 15px;
            min-height: 1.2em;
        }

        /* 3D-Karten-Container */
        .card-container {
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .flashcard {
            width: 100%;
            height: 220px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            padding: 25px;
            box-sizing: border-box;
            color: white;
            line-height: 1.4;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Kartenfarben */
        .card-front {
            background: linear-gradient(135deg, var(--color-card-front), #1565c0);
        }

        .card-back {
            background: linear-gradient(135deg, var(--color-card-back), #00838f);
            transform: rotateY(180deg);
        }
        
        /* Eingabe und Feedback */
        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .answer-input.correct {
            border-color: var(--color-success);
            background-color: #f1f8e9;
        }

        .answer-input.incorrect {
            border-color: var(--color-error);
            background-color: #ffebee;
        }

        .feedback {
            margin: 15px 0;
            font-weight: 600;
            min-height: 20px;
        }

        .feedback.correct { color: var(--color-success); }
        .feedback.incorrect { color: var(--color-error); }

        /* Buttons (Spiel) */
        .button {
            background-color: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 5px 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .button:hover:not(:disabled) {
            background-color: var(--color-secondary);
            transform: translateY(-2px);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button.next-button {
            background-color: var(--color-success);
        }
        .button.next-button:hover:not(:disabled) {
            background-color: #388e3c;
        }

        .button.back-button {
            background-color: #9e9e9e; /* Grau */
        }
        .button.back-button:hover:not(:disabled) {
            background-color: #757575;
        }
        
        /* Abschlussmeldung */
        .completion-message {
            background: linear-gradient(45deg, #ffb300, #ff8f00); 
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow);
            display: none;
        }
        
        .completion-message.show {
            display: block;
        }
    </style>
</head>
<body>
    
    <!-- STARTBILDSCHIRM (Wird zuerst angezeigt) -->
    <section id="menu-screen">
        <h1 class="menu-title">Unit 1: Vokabel-Trainer</h1>
        <div class="menu-grid" id="menuGrid">
            <!-- Buttons werden hier von JavaScript eingef√ºgt -->
        </div>
    </section>

    <!-- SPIEL-BEREICH (Ist standardm√§√üig versteckt) -->
    <main class="game-container" id="gameContainer" style="display: none;">
        <header>
            <h1 class="game-title" id="gameTitle"></h1>
        </header>
        
        <p id="attemptCount"></p>

        <section class="card-container">
            <div class="flashcard" id="flashcard">
                <div class="card-face card-front" id="cardFront"></div>
                <div class="card-face card-back" id="cardBack"></div>
            </div>
        </section>

        <p id="progressText"></p>

        <section class="input-section">
            <input type="text" class="answer-input" id="answerInput" placeholder="Englische Antwort eingeben..." disabled>
            <div class="feedback" id="feedback"></div>
            
            <button class="button" id="checkButton" onclick="checkAnswer()" disabled>Antwort pr√ºfen</button>
            <button class="button next-button" id="nextButton" onclick="nextCard()" style="display: none;">N√§chste Karte</button>
            <button class="button back-button" id="menuButton" onclick="backToMenu()">Zur√ºck zum Men√º</button>
        </section>

        <div class="completion-message" id="completionMessage">
            <h3>Gl√ºckwunsch! üéâ</h3>
            <p>Du hast alle Karten erfolgreich durchgearbeitet.</p>
            <button class="button" onclick="restartGame()">Nochmal spielen</button>
            <button class="button back-button" onclick="backToMenu()">Zur√ºck zum Men√º</button>
        </div>
    </main>

    <script>
        // #######################################################
        // 1. LERNKARTEN-DATEN (Mit L√ºckentext-Cues)
        // #######################################################
        const allCardSets = {
            "page143": {
                title: "Seite 143",
                cards: [
                    { id: 'diverse', front: 'unterschiedlich, [...]', back: 'diverse' },
                    { id: 'society', front: 'Gesellschaft', back: 'society' },
                    { id: 'apartheid', front: 'Apartheid (fr√ºheres System der Trennung)', back: 'apartheid' },
                    { id: 'relation', front: 'Beziehung, Verh√§ltnis; Bezug', back: 'relation' },
                    { id: 'pros_cons', front: 'Was sind the [...] and cons? (F√ºr und Wider)', back: 'pros and cons' },
                    { id: 'reserve', front: 'Schutzgebiet (an area which is protected for wildlife)', back: 'reserve' },
                    { id: 'facet', front: 'Facette', back: 'facet' },
                    { id: 'rainbow', front: 'Regenbogen', back: 'rainbow' },
                    { id: 'lingua_franca', front: 'English is a [...] in many parts of the world.', back: 'lingua franca' },
                    { id: 'non', front: 'Nicht- (non-white, non-stop flight)', back: 'non-' },
                    { id: 'weigh_heavily', front: 'schwer lasten auf jm. (to [...] heavily on sb.)', back: 'weigh heavily on sb.' },
                    { id: 'optimistic', front: 'optimistisch', back: 'optimistic' },
                    { id: 'pessimistic', front: 'optimistisch ‚óÄ‚ñ∂', back: 'pessimistic' },
                    { id: 'optimism', front: 'Optimismus', back: 'optimism' },
                    { id: 'pessimism', front: 'Optimismus ‚óÄ‚ñ∂', back: 'pessimism' },
                    { id: 'beyond', front: 'jenseits, au√üerhalb, weiter als', back: 'beyond' }
                ]
            },
            "page144": {
                title: "Seite 144",
                cards: [
                    { id: 'agree', front: 'etwas vereinbaren, sich einigen. (We [...] on this text.)', back: '(to) agree (on) sth.' },
                    { id: 'people_of_colour', front: 'nicht-wei√üe Menschen', back: 'people of colour' },
                    { id: 'phenomenon', front: 'Ph√§nomen, Erscheinung (pl. phenomena)', back: 'phenomenon' },
                    { id: 'fix', front: 'etwas in Ordnung bringen; reparieren. (I can [...] it.)', back: '(to) fix sth.' },
                    { id: 'wrong', front: 'Unrecht. (Teach your children the difference between right and [...])', back: 'wrong' },
                    { id: 'wrong_ant', front: 'wrong ‚óÄ‚ñ∂', back: 'right' },
                    { id: 'reform', front: 'Reform', back: 'reform' },
                    { id: 'youth', front: 'Jugend; Jugendlicher', back: 'youth' },
                    { id: 'growth', front: 'Wachstum. (Too much water will stop the plant‚Äôs [...].)', back: 'growth' },
                    { id: 'educational', front: 'Erziehungs-, Bildungs- (relating to education)', back: 'educational' },
                    { id: 'corruption', front: 'Korruption, Bestechlichkeit', back: 'corruption' },
                    { id: 'entrepreneur', front: 'Unternehmer/in ‚ñ∂‚ñ∂', back: 'businessman/businesswoman' },
                    { id: 'qualification', front: '(Schul-)Abschluss, Qualifikation', back: 'qualification' },
                    { id: 'diploma', front: 'Diplom, Abschlusszeugnis', back: 'diploma' },
                    { id: 'struggle', front: 'k√§mpfen, sich abm√ºhen. (I am [...] to understand.)', back: '(to) struggle' },
                    { id: 'nanny', front: 'Kinderm√§dchen (It‚Äôs my job to look after young children)', back: 'nanny' },
                    { id: 'party', front: 'Partei; Gruppe. (I‚Äôm a member of the Green [...].)', back: 'party' },
                    { id: 'fail', front: 'scheitern; (es) nicht schaffen', back: '(to) fail' },
                    { id: 'racism', front: 'Rassismus (Betonung auf der 1. Silbe)', back: 'racism' },
                    { id: 'necessarily', front: 'zwangsl√§ufig; (nicht) unbedingt', back: '(not) necessarily' },
                    { id: 'at_times', front: 'zeitweise, manchmal ‚ñ∂‚ñ∂', back: 'at times' }
                ]
            },
            "page145": {
                title: "Seite 145",
                cards: [
                    { id: 'grasp', front: 'verstehen, begreifen. (I find that hard to [...].)', back: '(to) grasp' },
                    { id: 'township', front: 'Township (Siedlung in S√ºdafrika)', back: 'township' },
                    { id: 'largely', front: 'gr√∂√ütenteils, √ºberwiegend ‚ñ∂‚ñ∂', back: 'mostly' },
                    { id: 'province', front: 'Provinz, Bundesland', back: 'province' },
                    { id: 'socialize', front: 'sich treffen (mit), unter Leute gehen', back: '(to) socialize (with)' },
                    { id: 'wrestle', front: 'ringen (mit), k√§mpfen (gegen)', back: '(to) wrestle (with)' },
                    { id: 'similarity', front: '√Ñhnlichkeit, Gemeinsamkeit', back: 'similarity' },
                    { id: 'similarity_ant', front: 'similarity ‚óÄ‚ñ∂', back: 'difference' },
                    { id: 'revolution', front: 'Revolution (Betonung auf der 3. Silbe)', back: 'revolution' },
                    { id: 'particular', front: 'bestimmte(r, s), spezielle(r, s)', back: 'particular' },
                    { id: 'transition', front: '√úbergang. (the [...] from summer to autumn)', back: 'transition' },
                    { id: 'clothing', front: 'Kleidung (no pl.)', back: 'clothing' },
                    { id: 'step', front: 'treten (Please [...] closer!)', back: '(to) step' },
                    { id: 'inner', front: 'innere(r, s). (Develop your [...] strength.)', back: 'inner' },
                    { id: 'inner_ant', front: 'inner ‚óÄ‚ñ∂', back: 'outer' },
                    { id: 'twist', front: '(sich) (ver)biegen, (sich) (ver)drehen', back: '(to) twist' },
                    { id: 'shuffle', front: 'schlurfen; mit den F√º√üen scharren', back: '(to) shuffle' },
                    { id: 'stamp', front: '(auf)stampfen', back: '(to) stamp' },
                    { id: 'rhythmic', front: 'rhythmisch, gleichm√§√üig', back: 'rhythmic' },
                    { id: 'variation', front: 'Variante, Variation; Ver√§nderung', back: 'variation' },
                    { id: 'limit', front: 'Grenze, Begrenzung, Beschr√§nkung', back: 'limit' }
                ]
            },
            "page146": {
                title: "Seite 146",
                cards: [
                    { id: 'resistance', front: 'Widerstand; Resistenz. (Don‚Äôt you expect [...].)', back: 'resistance' },
                    { id: 'shift', front: '(sich) verlagern; (sich) ver√§ndern', back: '(to) shift' },
                    { id: 'impulse', front: 'Impuls (Betonung auf der 1. Silbe)', back: 'impulse' },
                    { id: 'respond', front: 'reagieren, antworten (auf)', back: '(to) respond (to)' },
                    { id: 'gumboot', front: 'Gummistiefel', back: 'gumboot' },
                    { id: 'rural', front: 'l√§ndlich, Land- ‚ñ∂‚ñ∂', back: 'rural' },
                    { id: 'era', front: '√Ñra, Epoche', back: 'era' },
                    { id: 'chain', front: 'anketten, fesseln (mit Ketten)', back: '(to) chain' },
                    { id: 'slap', front: 'schlagen; knallen; klatschen', back: '(to) slap' },
                    { id: 'stomp', front: 'stampfen', back: '(to) stomp' },
                    { id: 'combine', front: 'verbinden, kombinieren', back: '(to) combine' },
                    { id: 'hardship', front: 'Not, M√ºhsal, harte Umst√§nde', back: 'hardship' },
                    { id: 'celebration', front: 'Feier', back: 'celebration' },
                    { id: 'choreographer', front: 'Choreograf/in (Betonung auf der 3. Silbe)', back: 'choreographer' },
                    { id: 'hurry', front: 'sich beeilen; eilen. ([...] up!)', back: '(to) hurry' }
                ]
            },
            "page147": {
                title: "Seite 147",
                cards: [
                    { id: 'game', front: 'Wild (Tiere, Fleisch)', back: 'game' },
                    { id: 'habitat', front: 'Lebensraum (natural [...] of the Tasmanian devil)', back: 'habitat' },
                    { id: 'rhino', front: 'Nashorn (infml)', back: 'rhino' },
                    { id: 'leopard', front: 'Leopard (Betonung auf der 1. Silbe)', back: 'leopard' },
                    { id: 'buffalo', front: 'B√ºffel; Bison', back: 'buffalo' },
                    { id: 'variety', front: 'Variante, Sorte, Art', back: 'variety' },
                    { id: 'informative', front: 'informativ (Betonung auf der 2. Silbe)', back: 'informative' },
                    { id: 'active', front: 'aktiv', back: 'active' },
                    { id: 'active_ant', front: 'active ‚óÄ‚ñ∂', back: 'passive' },
                    { id: 'as_well_as', front: 'sowohl ‚Ä¶ als auch ‚Ä¶', back: 'as well as' },
                    { id: 'initiative', front: 'Initiative (Betonung auf der 2. Silbe)', back: 'initiative' },
                    { id: 'rehabilitation', front: 'Rehabilitation', back: 'rehabilitation' },
                    { id: 'nurse', front: 'pflegen; (aus)kurieren', back: '(to) nurse' },
                    { id: 'return', front: 'zur√ºckgeben, zur√ºckbringen', back: '(to) return' },
                    { id: 'in_the_wild', front: 'in der Wildnis / in die Wildnis', back: 'in the wild / to the wild' },
                    { id: 'rescue', front: 'Rettung', back: 'rescue' },
                    { id: 'circus', front: 'Zirkus', back: 'circus' },
                    { id: 'lifelong', front: 'lebenslang', back: 'lifelong' },
                    { id: 'worldwide', front: 'weltweit ‚ñ∂‚ñ∂', back: 'worldwide' },
                    { id: 'radical', front: 'radikal', back: 'radical' }
                ]
            },
            "page148": {
                title: "Seite 148",
                cards: [
                    { id: 'poach', front: 'wildern, unerlaubt jagen', back: '(to) poach' },
                    { id: 'controversial', front: 'kontrovers, umstritten', back: 'controversial' },
                    { id: 'cub', front: '(L√∂wen-, B√§ren-)Junges', back: 'cub' },
                    { id: 'breed', front: 'br√ºten, Junge bekommen; z√ºchten', back: '(to) breed' },
                    { id: 'captive', front: 'gefangen, in Gefangenschaft', back: 'captive' },
                    { id: 'enclose', front: 'etwas (mit etwas) umgeben. (High walls [...] the castle gardens.)', back: '(to) enclose sth. in/with sth.' },
                    { id: 'instinct', front: 'Instinkt (Betonung auf der 1. Silbe)', back: 'instinct' },
                    { id: 'profit', front: 'profitieren (von)', back: '(to) profit (from)' },
                    { id: 'widespread', front: '(weit) verbreitet', back: 'widespread' },
                    { id: 'petition', front: 'Antrag, Petition (Unterschriftensammlung)', back: 'petition' },
                    { id: 'practice', front: 'Praktik, Vorgehensweise; Praxis', back: 'practice' },
                    { id: 'questionable', front: 'fragw√ºrdig', back: 'questionable' },
                    { id: 'operator', front: 'Betreiber/in (a tour [...])', back: 'operator' },
                    { id: 'brutal', front: 'brutal (Betonung auf der 1. Silbe)', back: 'brutal' },
                    { id: 'canned_hunting', front: 'Jagd auf in Gefangenschaft gezogene Tiere', back: 'canned hunting' },
                    { id: 'complaint', front: 'Beschwerde', back: 'complaint' },
                    { id: 'air_conditioning', front: 'Klimatisierung, Klimaanlage', back: 'air conditioning' },
                    { id: 'in_fact', front: 'tats√§chlich; eigentlich', back: 'in fact' }
                ]
            },
            "page149": {
                title: "Seite 149",
                cards: [
                    { id: 'little', front: 'wenig (little ‚Äì less ‚Äì least)', back: 'little' },
                    { id: 'circumstances', front: 'Umst√§nde, Verh√§ltnisse (pl.)', back: 'circumstances' },
                    { id: 'partial', front: 'teilweise, Teil-', back: 'partial' },
                    { id: 'refund', front: 'R√ºckzahlung, (Kosten-)Erstattung', back: 'refund' },
                    { id: 'receipt', front: '(Kauf-)Beleg, Quittung, Kassenzettel', back: 'receipt' },
                    { id: 'consequence', front: 'Folge, Konsequenz. (As a [...], I did badly.)', back: 'consequence' },
                    { id: 'demand', front: 'fordern, verlangen', back: '(to) demand' },
                    { id: 'elaborate', front: 'n√§her ausf√ºhren; ins Detail gehen', back: '(to) elaborate' },
                    { id: 'prompt', front: 'Stichwort, Vorgabe', back: 'prompt' },
                    { id: 'formulate', front: 'formulieren', back: '(to) formulate' },
                    { id: 'comedian', front: 'Komiker/in', back: 'comedian' },
                    { id: 'political', front: 'politisch', back: 'political' },
                    { id: 'commentator', front: 'Kommentator/in', back: 'commentator' },
                    { id: 'host', front: '(Radio-/TV-)Moderator/in; Gastgeber/in', back: 'host' },
                    { id: 'unique', front: 'einmalig, einzigartig', back: 'unique' }
                ]
            },
            "page150": {
                title: "Seite 150",
                cards: [
                    { id: 'light_skinned', front: '(hell)-h√§utig', back: '(light)-skinned' },
                    { id: 'take_right_left', front: '(nach) rechts/links abbiegen ‚ñ∂‚ñ∂', back: '(to) turn right/left' },
                    { id: 'whenever', front: 'wann (auch) immer', back: 'whenever' },
                    { id: 'yell', front: '(an)schreien, (an)br√ºllen', back: '(to) yell (at)' },
                    { id: 'pandemonium', front: 'Tumult, Chaos (no plural)', back: 'pandemonium' },
                    { id: 'genuine', front: 'echt, wirklich; aufrichtig', back: 'genuine' },
                    { id: 'clue', front: '(L√∂sungs-)Hinweis. (I don‚Äôt have a [...].)', back: 'clue' },
                    { id: 'face_to_face', front: 'von Angesicht zu Angesicht', back: 'face to face' },
                    { id: 'homeland', front: 'Heimat(land)', back: 'homeland' },
                    { id: 'option', front: 'Wahl(m√∂glichkeit), Option', back: 'option' },
                    { id: 'leg_up', front: 'jm. einen Vorsprung verschaffen', back: '(to) give sb. a leg up' },
                    { id: 'comprehension', front: 'Verst√§ndnis (English [...])', back: 'comprehension' },
                    { id: 'equate', front: 'etwas gleichsetzen (mit)', back: '(to) equate sth. (with)' },
                    { id: 'intelligence', front: 'Intelligenz (Betonung auf der 2. Silbe)', back: 'intelligence' }
                ]
            },
            "page151": {
                title: "Seite 151",
                cards: [
                    { id: 'dock', front: 'Anklagebank (to be in the [...])', back: 'dock' },
                    { id: 'get_away', front: 'davonkommen (mit)', back: '(to) get away (with) / (to) get off (with)' },
                    { id: 'fine', front: 'Geldstrafe (You might have to pay a [...].)', back: 'fine' },
                    { id: 'naughty', front: 'ungezogen, frech, unartig', back: 'naughty' },
                    { id: 'versed_in', front: 'versiert in etwas sein, gute Kenntnisse haben', back: '(to) be versed in sth.' },
                    { id: 'pick_up', front: 'sich etwas aneignen (Sprache/Kenntnisse)', back: '(to) pick sth. up' },
                    { id: 'upside', front: 'auf den Kopf, vor den Kopf (AE, infml)', back: 'upside (the head)' },
                    { id: 'idiot', front: 'Idiot/in (Betonung auf der 1. Silbe)', back: 'idiot' },
                    { id: 'passionate', front: 'leidenschaftlich', back: 'passionate' },
                    { id: 'oppress', front: 'unterdr√ºcken', back: '(to) oppress' },
                    { id: 'boundary', front: 'Grenze (Music can cross cultural [...])', back: 'boundary' },
                    { id: 'handle', front: 'mit etwas umgehen, etwas handhaben', back: '(to) handle sth.' },
                    { id: 'navigate', front: 'navigieren, den Weg finden', back: '(to) navigate' },
                    { id: 'shopkeeper', front: 'Ladenbesitzer/in', back: 'shopkeeper' },
                    { id: 'fluent', front: 'flie√üend (Sprache)', back: 'fluent' },
                    { id: 'merely', front: 'nur, blo√ü ‚ñ∂‚ñ∂', back: 'only' },
                    { id: 'brief', front: 'kurz, knapp ‚ñ∂‚ñ∂', back: 'short' },
                    { id: 'confusion', front: 'Verwirrung; Durcheinander', back: 'confusion' }
                ]
            },
            "page152": {
                title: "Seite 152",
                cards: [
                    { id: 'serve', front: 'servieren; Kundschaft bedienen; dienen. (This could [...] as an example.)', back: '(to) serve' },
                    { id: 'mug', front: 'jn. √ºberfallen (Stra√üenraub)', back: '(to) mug sb.' },
                    { id: 'dude', front: 'Mann, Alter (Anrede, infml)', back: 'dude' },
                    { id: 'incident', front: 'Vorfall, Zwischenfall', back: 'incident' },
                    { id: 'define', front: 'definieren', back: '(to) define' },
                    { id: 'chameleon', front: 'Cham√§leon (Echsenart)', back: 'chameleon' },
                    { id: 'perception', front: 'Wahrnehmung', back: 'perception' },
                    { id: 'barrier', front: 'Barriere', back: 'barrier' },
                    { id: 'architect', front: 'Architekt/in', back: 'architect' },
                    { id: 'effort', front: 'Anstrengung, M√ºhe. (to make an [...])', back: 'effort' },
                    { id: 'physical', front: 'k√∂rperlich, physisch', back: 'physical' },
                    { id: 'mood', front: 'Stimmung, Laune', back: 'mood' },
                    { id: 'atmosphere', front: 'Atmosph√§re (Betonung auf der 1. Silbe)', back: 'atmosphere' },
                    { id: 'theme', front: 'Thema', back: 'theme' },
                    { id: 'misunderstanding', front: 'Missverst√§ndnis', back: 'misunderstanding' },
                    { id: 'clarify', front: 'kl√§ren, klarstellen ‚ñ∂‚ñ∂', back: '(to) clarify' },
                    { id: 'rephrase', front: 'umformulieren, anders ausdr√ºcken', back: '(to) rephrase' },
                    { id: 'in_other_words', front: 'mit anderen Worten', back: 'in other words' },
                    { id: 'put_sth', front: 'etwas (auf eine bestimmte Art) ausdr√ºcken, formulieren', back: '(to) put sth.' }
                ]
            }
        };

        // #######################################################
        // 2. SPIELZUSTAND & DOM-ELEMENTE
        // #######################################################
        const MAX_ATTEMPTS = 3;
        let currentCardIndex = 0;
        let answered = false;
        let failedAttempts = 0; // Neu: Z√§hler f√ºr Fehlversuche
        let flashcards = []; 
        let totalCards = 0;

        const menuScreen = document.getElementById('menu-screen');
        const gameContainer = document.getElementById('gameContainer');
        const menuGrid = document.getElementById('menuGrid');
        
        const flashcardElement = document.getElementById('flashcard');
        const cardFrontElement = document.getElementById('cardFront');
        const cardBackElement = document.getElementById('cardBack');
        const answerInputElement = document.getElementById('answerInput');
        const checkButton = document.getElementById('checkButton');
        const nextButton = document.getElementById('nextButton');
        const attemptCountElement = document.getElementById('attemptCount'); // Neu: Versuchsanzeige
        const feedbackElement = document.getElementById('feedback');
        const completionMessage = document.getElementById('completionMessage');
        const progressTextElement = document.getElementById('progressText');
        const gameTitle = document.getElementById('gameTitle');

        // #######################################################
        // 3. MENU FUNKTIONEN
        // #######################################################
        
        /** Erzeugt die Auswahl-Buttons aus den Daten */
        function renderMenu() {
            menuGrid.innerHTML = ''; 
            
            const sortedKeys = Object.keys(allCardSets).sort((a, b) => {
                return parseInt(a.replace('page', '')) - parseInt(b.replace('page', ''));
            });

            sortedKeys.forEach(key => {
                const set = allCardSets[key];
                const button = document.createElement('button');
                button.classList.add('menu-button');
                button.textContent = set.title;
                button.onclick = () => loadGame(key);
                menuGrid.appendChild(button);
            });
            
            menuScreen.style.display = 'block';
            gameContainer.style.display = 'none';
        }
        
        /** L√§dt das ausgew√§hlte Spiel-Set */
        function loadGame(setKey) {
            const set = allCardSets[setKey];
            
            flashcards = set.cards;
            totalCards = flashcards.length;
            gameTitle.textContent = set.title;
            
            menuScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            
            currentCardIndex = 0;
            shuffleArray(flashcards); 
            startGame();
        }

        /** Geht vom Spiel zur√ºck zur Men√º-Auswahl */
        function backToMenu() {
            document.querySelector('.input-section').style.display = 'block';
            document.querySelector('.card-container').style.display = 'block';
            completionMessage.classList.remove('show');
            renderMenu();
        }

        // #######################################################
        // 4. SPIEL FUNKTIONEN (Kern-Logik mit Versuchsz√§hler)
        // #######################################################

        function showCard() {
            if (currentCardIndex >= totalCards) {
                showCompletion();
                return;
            }

            const card = flashcards[currentCardIndex];
            
            // UI zur√ºcksetzen
            flashcardElement.classList.remove('flipped');
            answerInputElement.value = '';
            answerInputElement.className = 'answer-input';
            feedbackElement.textContent = '';
            feedbackElement.className = 'feedback';
            failedAttempts = 0; // Z√§hler zur√ºcksetzen
            
            // Kartentexte und UI-Elemente setzen
            cardFrontElement.textContent = card.front;
            cardBackElement.textContent = card.back;
            
            checkButton.style.display = 'inline-block';
            nextButton.style.display = 'none';
            checkButton.disabled = false;
            answerInputElement.disabled = false;
            answered = false;

            updateProgress();
            updateAttemptCount();
        }

        function updateProgress() {
            progressTextElement.textContent = `Karte: ${currentCardIndex + 1} / ${totalCards}`;
        }
        
        function updateAttemptCount() {
            const remaining = MAX_ATTEMPTS - failedAttempts;
            if (remaining > 0) {
                 attemptCountElement.textContent = `Versuche verbleibend: ${remaining}`;
                 attemptCountElement.style.color = remaining === 1 ? varColorError : varColorText;
            } else {
                 attemptCountElement.textContent = '';
            }
        }

        function flipCard() {
            flashcardElement.classList.toggle('flipped');
        }

        /** Entfernt unn√∂tige Zeichen, Klammern, (to) und normiert die Antwort */
        function normalizeAnswer(text) {
            // Entspricht der Anforderung, (to) zu ignorieren
            return text.toLowerCase()
                       .replace(/\(to\)/g, '') 
                       .replace(/[\(\)]/g, '')
                       .replace(/sth\./g, '')
                       .replace(/in\./g, '')
                       .trim();
        }

        function checkAnswer() {
            if (answered) return;

            const card = flashcards[currentCardIndex];
            const rawUserAnswer = answerInputElement.value.trim();
            
            const userAnswer = normalizeAnswer(rawUserAnswer);
            const correctAnswers = card.back.split('/').map(ans => normalizeAnswer(ans));
            
            const isCorrect = correctAnswers.some(ans => userAnswer === ans);
            
            if (isCorrect) {
                // FALL 1: KORREKT
                answered = true;
                checkButton.disabled = true;
                answerInputElement.classList.add('correct');
                feedbackElement.textContent = '‚úì Richtig! Gut gemacht!';
                feedbackElement.classList.add('correct');
                
                // N√§chsten Schritt anzeigen
                setTimeout(flipCard, 500);
                nextButton.style.display = 'inline-block';
                answerInputElement.disabled = true;
                attemptCountElement.textContent = '';
                
            } else {
                // FALL 2: FALSCH
                failedAttempts++;
                
                answerInputElement.classList.add('incorrect');
                
                if (failedAttempts >= MAX_ATTEMPTS) {
                    // FALL 2a: Falsch und MAX_ATTEMPTS erreicht
                    answered = true;
                    checkButton.disabled = true;
                    feedbackElement.textContent = `‚úó Falsch. Die korrekte Antwort war: "${card.back}"`;
                    feedbackElement.classList.add('incorrect');
                    
                    // N√§chsten Schritt anzeigen
                    setTimeout(flipCard, 500);
                    nextButton.style.display = 'inline-block';
                    answerInputElement.disabled = true;
                    attemptCountElement.textContent = '';

                } else {
                    // FALL 2b: Falsch, aber weitere Versuche erlaubt
                    answerInputElement.classList.remove('correct', 'incorrect'); // Visuell zur√ºcksetzen
                    answerInputElement.value = ''; // Eingabe leeren
                    feedbackElement.textContent = `Falsch. Versuch ${failedAttempts} von ${MAX_ATTEMPTS} fehlgeschlagen.`;
                    feedbackElement.classList.remove('correct');
                    feedbackElement.classList.add('incorrect');
                    
                    updateAttemptCount();
                }
            }
        }

        function nextCard() {
            currentCardIndex++;
            showCard();
        }

        function showCompletion() {
            document.querySelector('.input-section').style.display = 'none';
            document.querySelector('.card-container').style.display = 'none';
            progressTextElement.style.display = 'none';
            attemptCountElement.style.display = 'none';
            completionMessage.classList.add('show');
        }

        function restartGame() {
            currentCardIndex = 0;
            shuffleArray(flashcards); 
            document.querySelector('.input-section').style.display = 'block';
            document.querySelector('.card-container').style.display = 'block';
            progressTextElement.style.display = 'block';
            attemptCountElement.style.display = 'block';
            completionMessage.classList.remove('show');
            startGame();
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function startGame() {
            showCard();
            flashcardElement.removeEventListener('click', flipCard);
            flashcardElement.addEventListener('click', flipCard);
        }


        // #######################################################
        // 5. INITIALISIERUNG
        // #######################################################
        
        window.onload = () => {
             // CSS-Variable f√ºr Fehlermeldung im JS verf√ºgbar machen
             window.varColorError = getComputedStyle(document.documentElement).getPropertyValue('--color-error');
             window.varColorText = getComputedStyle(document.documentElement).getPropertyValue('--color-text');
             renderMenu();
        }
    </script>
</body>
</html>
