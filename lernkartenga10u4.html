<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vokabel-Trainer: Unit 4</title>
    
    <!-- Google Font f√ºr handschriftliche √úberschrift -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600&display=swap" rel="stylesheet">

    <style>
        /* Dezentes Magenta-Styling */
        :root {
            --color-primary: #ec407a; /* Helles Magenta/Pink */
            --color-secondary: #ad1457; /* Dunkles Weinrot */
            --color-background: #fce4ec; /* Sehr helles Rosa */
            --color-text: #263238; /* Dunkelgrau */
            --color-success: #43a047; /* Gr√ºn f√ºr Korrekt */
            --color-error: #e53935; /* Rot f√ºr Fehler */
            --color-card-front: #ff80ab; /* Kartenfarbe Vorderseite */
            --color-card-back: #e91e63; /* Kartenfarbe R√ºckseite */
            --shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--color-background) 0%, var(--color-primary) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 550px;
            width: 95%;
            text-align: center;
            margin-top: 5vh;
        }

        /* HANDSCHRIFTLICHE √úBERSCHRIFT */
        .game-title, .menu-title {
            font-family: 'Caveat', cursive;
            font-size: 36px;
            font-weight: 600;
            color: var(--color-secondary);
            margin-bottom: 20px;
            text-align: center; 
        }
        
        /* STARTBILDSCHIRM STYLING */
        #menu-screen {
            padding: 30px;
            max-width: 600px;
            width: 95%;
            margin-top: 10vh;
            background: white; 
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .menu-button {
            width: 100%;
            background-color: var(--color-background);
            color: var(--color-secondary);
            border: 2px solid var(--color-primary);
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .menu-button:hover {
            background-color: var(--color-primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Fortschritts- und Versuchsanzeige */
        #progressText {
            font-weight: 500;
            color: var(--color-text);
            margin-bottom: 5px;
        }
        
        #attemptCount {
            font-weight: bold;
            color: var(--color-error);
            margin-bottom: 15px;
            min-height: 1.2em;
        }

        /* 3D-Karten-Container */
        .card-container {
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .flashcard {
            width: 100%;
            height: 220px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            cursor: default; 
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            padding: 25px;
            box-sizing: border-box;
            color: white;
            line-height: 1.4;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Kartenfarben */
        .card-front {
            background: linear-gradient(135deg, var(--color-card-front), #f06292);
        }

        .card-back {
            background: linear-gradient(135deg, var(--color-card-back), #c2185b);
            transform: rotateY(180deg);
        }
        
        /* Eingabe und Feedback */
        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .answer-input.correct {
            border-color: var(--color-success);
            background-color: #f1f8e9;
        }

        .answer-input.incorrect {
            border-color: var(--color-error);
            background-color: #ffebee;
        }

        .feedback {
            margin: 15px 0;
            font-weight: 600;
            min-height: 20px;
        }

        .feedback.correct { color: var(--color-success); }
        .feedback.incorrect { color: var(--color-error); }

        /* Buttons (Spiel) */
        .button {
            background-color: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 5px 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .button:hover:not(:disabled) {
            background-color: var(--color-secondary);
            transform: translateY(-2px);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button.next-button {
            background-color: var(--color-success);
        }
        .button.next-button:hover:not(:disabled) {
            background-color: #388e3c;
        }

        .button.back-button {
            background-color: #9e9e9e; /* Grau */
        }
        .button.back-button:hover:not(:disabled) {
            background-color: #757575;
        }
        
        /* Abschlussmeldung */
        .completion-message {
            background: linear-gradient(45deg, #ff80ab, #e91e63); 
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow);
            display: none;
        }
        
        .completion-message.show {
            display: block;
        }
    </style>
</head>
<body>
    
    <!-- STARTBILDSCHIRM (Wird zuerst angezeigt) -->
    <section id="menu-screen">
        <h1 class="menu-title">Unit 4: Vokabel-Trainer</h1>
        <div class="menu-grid" id="menuGrid">
            <!-- Buttons werden hier von JavaScript eingef√ºgt -->
        </div>
    </section>

    <!-- SPIEL-BEREICH (Ist standardm√§√üig versteckt) -->
    <main class="game-container" id="gameContainer" style="display: none;">
        <header>
            <h1 class="game-title" id="gameTitle"></h1>
        </header>
        
        <p id="attemptCount"></p>

        <section class="card-container">
            <div class="flashcard" id="flashcard">
                <div class="card-face card-front" id="cardFront"></div>
                <div class="card-face card-back" id="cardBack"></div>
            </div>
        </section>

        <p id="progressText"></p>

        <section class="input-section">
            <input type="text" class="answer-input" id="answerInput" placeholder="Englische Antwort eingeben..." disabled>
            <div class="feedback" id="feedback"></div>
            
            <button class="button" id="checkButton" onclick="checkAnswer()" disabled>Antwort pr√ºfen</button>
            <button class="button next-button" id="nextButton" onclick="nextCard()" style="display: none;">N√§chste Karte</button>
            <button class="button back-button" id="menuButton" onclick="backToMenu()">Zur√ºck zum Men√º</button>
        </section>

        <div class="completion-message" id="completionMessage">
            <h3>Gl√ºckwunsch! üéâ</h3>
            <p>Du hast alle Karten erfolgreich durchgearbeitet.</p>
            <button class="button" onclick="restartGame()">Nochmal spielen</button>
            <button class="button back-button" onclick="backToMenu()">Zur√ºck zum Men√º</button>
        </div>
    </main>

    <script>
        // #######################################################
        // 1. LERNKARTEN-DATEN (Unit 4, aufgeteilt nach Seiten)
        // #######################################################
        const allCardSets = {
            "page174": {
                title: "Seite 174",
                cards: [
                    { id: 'examine', front: 'untersuchen', back: '(to) examine' },
                    { id: 'individual', front: 'Einzelne/r, Individuum; Person', back: 'individual' },
                    { id: 'participate', front: 'teilnehmen (an), sich beteiligen (an) ‚ñ∂‚ñ∂', back: '(to) take part (in)' },
                    { id: 'donation', front: 'Spende (to make a [...])', back: 'donation' },
                    { id: 'cycle', front: 'Rad fahren ‚ñ∂‚ñ∂', back: '(to) ride a/your bike' },
                    { id: 'consumerism', front: 'Konsumismus, konsumorientiertes Verhalten', back: 'consumerism' },
                    { id: 'extinction', front: 'Ausrottung, Aussterben', back: 'extinction' },
                    { id: 'activism', front: 'Aktivismus (Betonung auf der 1. Silbe)', back: 'activism' },
                    { id: 'front_line', front: 'Front (milit√§risch) (in/on the [...])', back: 'front line' },
                    { id: 'elderly', front: '√§ltere(r, s) (politer word for "old")', back: 'elderly' },
                    { id: 'marginalize', front: 'ins Abseits dr√§ngen, an den Rand dr√§ngen', back: '(to) marginalize' }
                ]
            },
            "page175": {
                title: "Seite 175",
                cards: [
                    { id: 'witness', front: 'etwas (mit)erleben, Zeuge/Zeugin werden von etwas', back: '(to) witness sth.' },
                    { id: 'first_hand', front: 'aus erster Hand (first-hand experience)', back: 'first-hand' },
                    { id: 'damage', front: 'Schaden, Sch√§den (an) (no pl)', back: 'damage (to)' },
                    { id: 'intense', front: 'intensiv, enorm', back: 'intense' },
                    { id: 'landslide', front: 'Erdrutsch', back: 'landslide' },
                    { id: 'end_up', front: '(schlie√ülich) enden, landen. (You might [...] in prison.)', back: '(to) end up' },
                    { id: 'painful', front: 'schmerzhaft ‚ñ∂‚ñ∂', back: 'causing pain' },
                    { id: 'impact', front: 'Einfluss, Auswirkung. (What [...] does this have?)', back: 'impact' },
                    { id: 'major', front: 'gro√ü, bedeutend; Haupt- ‚ñ∂‚ñ∂', back: 'very large; very important' },
                    { id: 'frequent', front: 'h√§ufig', back: 'frequent' },
                    { id: 'no_longer', front: 'nicht mehr ‚ñ∂‚ñ∂', back: 'not ... any more' },
                    { id: 'habitable', front: 'bewohnbar', back: 'habitable' },
                    { id: 'habitable_ant', front: 'habitable ‚óÄ‚ñ∂', back: 'uninhabitable' },
                    { id: 'crisis', front: 'Krise (pl crises)', back: 'crisis' },
                    { id: 'unite', front: 'jn./etwas vereinigen, verbinden (mit)', back: '(to) unite sb./sth. (with)' },
                    { id: 'harmony', front: 'Harmonie, Einklang (Betonung auf der 1. Silbe)', back: 'harmony' },
                    { id: 'toxic', front: 'toxisch, giftig (toxic waste)', back: 'toxic' }
                ]
            },
            "page176": {
                title: "Seite 176",
                cards: [
                    { id: 'dump', front: '(M√ºll-)Abladeplatz, Deponie', back: 'dump' },
                    { id: 'inseparable', front: 'untrennbar (miteinander verbunden)', back: 'inseparable' },
                    { id: 'counterpart', front: 'Pendant, Gegenst√ºck; Gegen√ºber', back: 'counterpart' },
                    { id: 'unjust', front: 'ungerecht', back: 'unjust' },
                    { id: 'unjust_ant', front: 'unjust ‚óÄ‚ñ∂', back: 'just' },
                    { id: 'target', front: 'auf jn. zielen (jn. als Zielgruppe haben/w√§hlen)', back: '(to) target sb.' },
                    { id: 'risk', front: 'Risiko (I wouldn‚Äôt take that [...])', back: 'risk' },
                    { id: 'solidarity', front: 'Solidarit√§t', back: 'solidarity' },
                    { id: 'related', front: 'zugeh√∂rig, verbunden, verwandt (mit)', back: 'related (to)' },
                    { id: 'floodwater', front: 'Flutwasser (pl floodwaters)', back: 'floodwater' },
                    { id: 'tackle', front: '(Problem) angehen, in Angriff nehmen; bew√§ltigen', back: '(to) tackle' },
                    { id: 'exaggerate', front: '√ºbertreiben', back: '(to) exaggerate' }
                ]
            },
            "page177": {
                title: "Seite 177",
                cards: [
                    { id: 'committee', front: 'Ausschuss, Kommission, Komitee', back: 'committee' },
                    { id: 'intercultural', front: 'interkulturell', back: 'intercultural' },
                    { id: 'cutlery', front: 'Besteck', back: 'cutlery' },
                    { id: 'container', front: 'Beh√§lter; Container', back: 'container' },
                    { id: 'capable', front: 'f√§hig (zu), imstande (zu)', back: 'capable (of)' },
                    { id: 'adapt', front: 'adaptieren, (sich) anpassen', back: '(to) adapt' },
                    { id: 'innovation', front: 'Innovation, Neuerung', back: 'innovation' },
                    { id: 'biodegradable', front: 'biologisch abbaubar', back: 'biodegradable' },
                    { id: 'reusable', front: 'wiederverwendbar', back: 'reusable' },
                    { id: 'bring_up', front: 'etwas erw√§hnen, zur Sprache bringen', back: '(to) bring sth. up' },
                    { id: 'commitment', front: 'Bekenntnis (zu); Engagement, Einsatz (f√ºr)', back: 'commitment (to sb./sth.)' },
                    { id: 'average', front: 'durchschnittlich; Durchschnitt', back: 'average' },
                    { id: 'enable', front: 'es jm. erm√∂glichen, etwas zu tun', back: '(to) enable sb. to do sth.' },
                    { id: 'general_assembly', front: 'Vollversammlung, Generalversammlung', back: 'general assembly' },
                    { id: 'approve', front: 'genehmigen, anerkennen', back: '(to) approve' },
                    { id: 'till', front: 'bis ‚ñ∂‚ñ∂', back: 'until' }
                ]
            },
            "page178": {
                title: "Seite 178",
                cards: [
                    { id: 'intention', front: 'Absicht, Vorsatz', back: 'intention' },
                    { id: 'measure', front: 'Ma√ü(nahme) (to take [...])', back: 'measure' },
                    { id: 'transform', front: '(sich) verwandeln; umwandeln', back: '(to) transform' },
                    { id: 'planet', front: 'Planet (Betonung auf der 1. Silbe)', back: 'planet' },
                    { id: 'amount', front: 'Menge; Betrag (a large [...] of money)', back: 'amount' },
                    { id: 'carbon_dioxide', front: 'Kohlendioxid (CO2)', back: 'carbon dioxide (CO2)' },
                    { id: 'open_minded', front: 'offen, aufgeschlossen (gegen√ºber)', back: 'open-minded (about)' },
                    { id: 'open_minded_ant', front: 'open-minded ‚óÄ‚ñ∂', back: 'narrow-minded' },
                    { id: 'leadership', front: 'F√ºhrung', back: 'leadership' },
                    { id: 'comparison', front: 'Vergleich; Steigerung', back: 'comparison' },
                    { id: 'eco_friendly', front: 'umweltfreundlich ‚ñ∂‚ñ∂', back: 'environment-friendly' },
                    { id: 'presenter', front: 'Moderator/in; Referent/in', back: 'presenter' },
                    { id: 'garment', front: 'Kleidungsst√ºck', back: 'garment' },
                    { id: 'uncover', front: 'aufdecken; freilegen', back: '(to) uncover' }
                ]
            },
            "page179": {
                title: "Seite 179",
                cards: [
                    { id: 'manufacture', front: 'herstellen, produzieren, fertigen', back: '(to) manufacture' },
                    { id: 'investigate', front: 'untersuchen; ermitteln', back: '(to) investigate' },
                    { id: 'letter_to_the_editor', front: 'Leserbrief', back: 'letter to the editor' },
                    { id: 'praise', front: 'loben, r√ºhmen', back: '(to) praise' },
                    { id: 'expose', front: 'aufdecken, entlarven; freilegen', back: '(to) expose' },
                    { id: 'criminal', front: 'kriminell (adjective)', back: 'criminal' },
                    { id: 'balance', front: 'ausgleichen, ins Gleichgewicht bringen', back: '(to) balance' },
                    { id: 'journalism', front: 'Journalismus (Betonung auf der 1. Silbe)', back: 'journalism' },
                    { id: 'evidence', front: 'Nachweis(e), Beweis(e) (no pl)', back: 'evidence' },
                    { id: 'whats_more', front: 'Dar√ºber hinaus ‚Ä¶, Au√üerdem ‚Ä¶', back: 'What‚Äôs more, ‚Ä¶' },
                    { id: 'representative', front: 'Repr√§sentant/in, Vertreter/in', back: 'representative' },
                    { id: 'rather', front: 'ziemlich ‚ñ∂‚ñ∂', back: 'quite' },
                    { id: 'spot_on', front: 'haargenau richtig', back: 'spot on' },
                    { id: 'punish', front: 'bestrafen', back: '(to) punish' },
                    { id: 'once_more', front: 'noch einmal, wieder einmal ‚ñ∂‚ñ∂', back: 'one more time' },
                    { id: 'colony', front: 'Kolonie (Betonung auf der 1. Silbe)', back: 'colony' },
                    { id: 'preserve', front: 'bewahren, erhalten', back: '(to) preserve' }
                ]
            },
            "page180": {
                title: "Seite 180",
                cards: [
                    { id: 'cryogenic', front: 'Tieftemperatur-', back: 'cryogenic' },
                    { id: 'cryonics', front: 'Kryotechnik (Kryokonservierung)', back: 'cryonics' },
                    { id: 'laboratory', front: 'Labor (infml: lab)', back: 'laboratory' },
                    { id: 'technician', front: 'Techniker/in', back: 'technician' },
                    { id: 'type_in', front: '(ein)tippen. (Please [...] your name.)', back: '(to) type (in)' },
                    { id: 'approach', front: 'sich n√§hern, n√§her kommen', back: '(to) approach' },
                    { id: 'seal_up', front: 'etwas mit etwas abdichten, versiegeln', back: '(to) seal sth. (up) with sth.' },
                    { id: 'tube', front: 'Schlauch; Tube; Rohr', back: 'tube' },
                    { id: 'wire', front: 'Draht', back: 'wire' },
                    { id: 'cram', front: '(hinein)stopfen, (sich) hineindr√§ngen', back: '(to) cram' },
                    { id: 'liquid', front: 'Fl√ºssigkeit', back: 'liquid' },
                    { id: 'vein', front: 'Vene', back: 'vein' },
                    { id: 'grunt', front: 'Grunzen, Grunzlaut; √Ñchzen', back: 'grunt' },
                    { id: 'squeeze', front: '(zusammen)dr√ºcken; (sich) zw√§ngen', back: '(to) squeeze' },
                    { id: 'stroke', front: 'streicheln', back: '(to) stroke' },
                    { id: 'anything_but', front: 'alles andere als ‚Ä¶ (Houses are [...] cheap.)', back: 'anything but ‚Ä¶' },
                    { id: 'crook', front: 'Armbeuge, Ellenbeuge (the [...] of your elbow)', back: 'crook' }
                ]
            },
            "page181": {
                title: "Seite 181",
                cards: [
                    { id: 'tug', front: 'ziehen (z.B. am √Ñrmel)', back: '(to) tug' },
                    { id: 'tactic', front: 'Taktik', back: 'tactic' },
                    { id: 'muscle', front: 'Muskel', back: 'muscle' },
                    { id: 'chest', front: 'Brust, Brustkorb', back: 'chest' },
                    { id: 'hose', front: 'Schlauch (a garden [...])', back: 'hose' },
                    { id: 'speckle', front: 'Tupfen, Sprenkel (blue-speckled)', back: 'speckle' },
                    { id: 'shoebox', front: 'Schuhkarton', back: 'shoebox' },
                    { id: 'rush', front: 'eilen; hetzen; (schnell) flie√üen', back: '(to) rush' },
                    { id: 'bubble', front: 'Bl√§schen, Blase', back: 'bubble' },
                    { id: 'lower', front: 'sinken (lassen), (sich) senken, herabsetzen', back: '(to) lower' },
                    { id: 'lid', front: 'Deckel', back: 'lid' },
                    { id: 'mortuary', front: 'Leichenhalle; Leichenschauhaus', back: 'mortuary' },
                    { id: 'hiss', front: '(das/ein) Zischen, Fauchen', back: 'hiss' },
                    { id: 'steam', front: 'Dampf', back: 'steam' },
                    { id: 'flash_freeze', front: 'schockgefrieren (to [...] very quickly)', back: '(to) flash freeze' },
                    { id: 'ball', front: '(sich) ballen (einen Ball formen)', back: '(to) ball' }
                ]
            },
            "page182": {
                title: "Seite 182",
                cards: [
                    { id: 'back_down', front: 'einen R√ºckzieher machen (infml)', back: '(to) back down' },
                    { id: 'guilt_into', front: 'jn. moralisch zu etwas verpflichten', back: '(to) guilt sb. into sth.' },
                    { id: 'trail', front: 'Spur; Weg, Pfad; Route', back: 'trail' },
                    { id: 'mission', front: 'Mission; Auftrag (Betonung auf der 1. Silbe)', back: 'mission' },
                    { id: 'military', front: 'das Milit√§r', back: 'the military' },
                    { id: 'pete_sake', front: 'Um Himmels Willen! (Oh, for [...])', back: 'For Pete‚Äôs sake!' },
                    { id: 'battlefield', front: 'Schlachtfeld', back: 'battlefield' },
                    { id: 'analyst', front: 'Experte/Expertin; Analyst/in', back: 'analyst' },
                    { id: 'point', front: 'Sinn, Zweck. (What‚Äôs the [...] of that?)', back: 'point' },
                    { id: 'command', front: 'Anordnung; Befehl', back: 'command' },
                    { id: 'genetic', front: 'genetisch', back: 'genetic' },
                    { id: 'splice', front: 'verkleben; versplei√üen (genetic [...])', back: '(to) splice' },
                    { id: 'crop', front: 'Feldfrucht, Anbaupflanze; Ernte', back: 'crop' },
                    { id: 'undress', front: 'sich ausziehen', back: '(to) undress' },
                    { id: 'chamber', front: 'Kammer (underground [...])', back: 'chamber' },
                    { id: 'the_inside', front: 'das Innere, die Innenseite', back: 'the inside' }
                ]
            },
            "page183": {
                title: "Seite 183",
                cards: [
                    { id: 'stick', front: 'kleben; stecken; (haften) bleiben (It will always [...] in my mind.)', back: '(to) stick' },
                    { id: 'intravenous', front: 'intraven√∂s (IV)', back: 'intravenous (= IV)' },
                    { id: 'needle', front: 'Nadel; Kan√ºle', back: 'needle' },
                    { id: 'spine', front: 'Wirbels√§ule, R√ºckgrat', back: 'spine' },
                    { id: 'pinky', front: 'kleiner Finger (AE)', back: 'pinky (finger)' },
                    { id: 'wrap', front: 'etwas in etwas (ein)wickeln', back: '(to) wrap sth. in/with sth.' },
                    { id: 'slam', front: '(hin)knallen, zuschlagen (T√ºr)', back: '(to) slam' },
                    { id: 'puff', front: 'Sto√ü, (Luft-)Zug, Wolke', back: 'puff' },
                    { id: 'jerk', front: 'rucken, mit einem Ruck ziehen/sto√üen', back: '(to) jerk' },
                    { id: 'translucent', front: 'durchscheinend', back: 'translucent' },
                    { id: 'solid', front: 'fest, solide, stabil', back: 'solid' },
                    { id: 'go_under', front: 'untergehen (unter Wasser); zu Grunde gehen', back: '(to) go under' },
                    { id: 'watery', front: 'w√§ssrig, Wasser-', back: 'watery' },
                    { id: 'drift', front: 'treiben, wehen; sich bewegen, driften', back: '(to) drift' }
                ]
            },
            "page184": {
                title: "Seite 184",
                cards: [
                    { id: 'splutter', front: 'schnauben, prusten', back: '(to) splutter' },
                    { id: 'remove', front: 'entfernen, beseitigen; ausziehen (Kleidung)', back: '(to) remove' },
                    { id: 'engineering', front: 'Ingenieurwesen, Maschinenbau', back: 'engineering' },
                    { id: 'ambitious', front: 'ehrgeizig', back: 'ambitious' },
                    { id: 'circulate', front: 'zirkulieren, sich (im Kreis) bewegen', back: '(to) circulate' },
                    { id: 'percentage', front: 'Anteil, Prozentsatz', back: 'percentage' },
                    { id: 'patch', front: 'Flicken; Fleck, Stelle; St√ºck (Stoff)', back: 'patch' },
                    { id: 'garbage', front: 'M√ºll, Abfall (AE) ‚ñ∂‚ñ∂', back: 'rubbish' },
                    { id: 'wave', front: 'Welle', back: 'wave' },
                    { id: 'research', front: 'erforschen, untersuchen, recherchieren', back: '(to) research' },
                    { id: 'invest', front: 'investieren (in)', back: '(to) invest (in)' },
                    { id: 'trial', front: 'Test, Studie; Probe (Gerichtsverfahren)', back: 'trial' },
                    { id: 'place', front: 'stellen, legen, setzen, platzieren ‚ñ∂‚ñ∂', back: '(to) put (sth. somewhere)' },
                    { id: 'strategic', front: 'strategisch', back: 'strategic' },
                    { id: 'solar_power', front: 'Sonnenenergie', back: 'solar power' },
                    { id: 'conveyor_belt', front: 'Transportband, F√∂rderband; Flie√üband', back: 'conveyor (belt)' }
                ]
            },
            "page185": {
                title: "Seite 185",
                cards: [
                    { id: 'technological', front: 'technologisch', back: 'technological' },
                    { id: 'order', front: 'Reihenfolge (in the wrong [...])', back: 'order' },
                    { id: 'and_so_on', front: 'und so weiter ‚ñ∂‚ñ∂', back: 'etc.' },
                    { id: 'contribute', front: 'beitragen, beisteuern (zu); spenden (f√ºr)', back: '(to) contribute (to/towards)' },
                    { id: 'systematic', front: 'systematisch', back: 'systematic' },
                    { id: 'expand_on', front: 'etwas weiter ausf√ºhren', back: '(to) expand on sth.' },
                    { id: 'so_far', front: 'bis jetzt, bis hierher ‚ñ∂‚ñ∂', back: 'up to now' },
                    { id: 'group', front: 'gruppieren', back: '(to) group' }
                ]
            }
        };

        // #######################################################
        // 2. SPIELZUSTAND & DOM-ELEMENTE
        // #######################################################
        const MAX_ATTEMPTS = 3;
        let currentCardIndex = 0;
        let answered = false;
        let failedAttempts = 0; 
        let flashcards = []; 
        let totalCards = 0;

        const menuScreen = document.getElementById('menu-screen');
        const gameContainer = document.getElementById('gameContainer');
        const menuGrid = document.getElementById('menuGrid');
        
        const flashcardElement = document.getElementById('flashcard');
        const cardFrontElement = document.getElementById('cardFront');
        const cardBackElement = document.getElementById('cardBack');
        const answerInputElement = document.getElementById('answerInput');
        const checkButton = document.getElementById('checkButton');
        const nextButton = document.getElementById('nextButton');
        const attemptCountElement = document.getElementById('attemptCount'); 
        const feedbackElement = document.getElementById('feedback');
        const completionMessage = document.getElementById('completionMessage');
        const progressTextElement = document.getElementById('progressText');
        const gameTitle = document.getElementById('gameTitle');

        // #######################################################
        // 3. MENU FUNKTIONEN
        // #######################################################
        
        /** Erzeugt die Auswahl-Buttons aus den Daten */
        function renderMenu() {
            menuGrid.innerHTML = ''; 
            
            // Sortiert die Keys (page174, page175, ...) numerisch
            const sortedKeys = Object.keys(allCardSets).sort((a, b) => {
                return parseInt(a.replace('page', '')) - parseInt(b.replace('page', ''));
            });

            sortedKeys.forEach(key => {
                const set = allCardSets[key];
                const button = document.createElement('button');
                button.classList.add('menu-button');
                button.textContent = set.title;
                button.onclick = () => loadGame(key);
                menuGrid.appendChild(button);
            });
            
            menuScreen.style.display = 'block';
            gameContainer.style.display = 'none';
        }
        
        /** L√§dt das ausgew√§hlte Spiel-Set */
        function loadGame(setKey) {
            const set = allCardSets[setKey];
            
            flashcards = set.cards;
            totalCards = flashcards.length;
            gameTitle.textContent = set.title;
            
            menuScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            
            currentCardIndex = 0;
            shuffleArray(flashcards); 
            startGame();
        }

        /** Geht vom Spiel zur√ºck zur Men√º-Auswahl */
        function backToMenu() {
            document.querySelector('.input-section').style.display = 'block';
            document.querySelector('.card-container').style.display = 'block';
            completionMessage.classList.remove('show');
            renderMenu();
        }

        // #######################################################
        // 4. SPIEL FUNKTIONEN (Kern-Logik mit Versuchsz√§hler)
        // #######################################################

        function showCard() {
            if (currentCardIndex >= totalCards) {
                showCompletion();
                return;
            }

            const card = flashcards[currentCardIndex];
            
            // UI zur√ºcksetzen
            flashcardElement.classList.remove('flipped');
            answerInputElement.value = '';
            answerInputElement.className = 'answer-input';
            feedbackElement.textContent = '';
            feedbackElement.className = 'feedback';
            failedAttempts = 0; 
            
            // Kartentexte und UI-Elemente setzen
            cardFrontElement.textContent = card.front;
            cardBackElement.textContent = card.back;
            
            checkButton.style.display = 'inline-block';
            nextButton.style.display = 'none';
            checkButton.disabled = false;
            answerInputElement.disabled = false;
            answered = false;

            updateProgress();
            updateAttemptCount();
            
            // Cursor auf default setzen, da manuelle Klicks deaktiviert sind
            flashcardElement.style.cursor = 'default'; 
        }

        function updateProgress() {
            progressTextElement.textContent = `Karte: ${currentCardIndex + 1} / ${totalCards}`;
        }
        
        function updateAttemptCount() {
            const remaining = MAX_ATTEMPTS - failedAttempts;
            const varColorError = getComputedStyle(document.documentElement).getPropertyValue('--color-error');
            const varColorText = getComputedStyle(document.documentElement).getPropertyValue('--color-text');

            if (remaining > 0) {
                 attemptCountElement.textContent = `Versuche verbleibend: ${remaining}`;
                 attemptCountElement.style.color = remaining === 1 ? varColorError : varColorText;
            } else {
                 attemptCountElement.textContent = '';
            }
        }

        function flipCard() {
            // Die Karte nur flippen, wenn die Antwort feststeht (nach checkAnswer)
            if (answered) {
                flashcardElement.classList.toggle('flipped');
            }
        }

        /** 
         * Entfernt unn√∂tige Zeichen, Klammern etc., beh√§lt aber Gro√ü-/Kleinschreibung bei!
         * (Wurde korrigiert, indem .toLowerCase() entfernt wurde)
         */
        function normalizeAnswer(text) {
            // Ignoriert '(to)', Klammern und Endungen wie 'sth.', beh√§lt aber Casing bei
            return text.replace(/\(to\)/g, '') 
                       .replace(/[\(\)]/g, '')
                       .replace(/sth\./g, '')
                       .replace(/in\./g, '')
                       .trim();
        }

        function checkAnswer() {
            if (answered) return;

            const card = flashcards[currentCardIndex];
            const rawUserAnswer = answerInputElement.value.trim();
            
            // Die Pr√ºfung ist jetzt case-sensitive
            const userAnswer = normalizeAnswer(rawUserAnswer);
            // Korrekte Antworten werden ebenfalls nur bereinigt (ohne .toLowerCase())
            const correctAnswers = card.back.split('/').map(ans => normalizeAnswer(ans)); 
            
            const isCorrect = correctAnswers.some(ans => userAnswer === ans);
            
            if (isCorrect) {
                // FALL 1: KORREKT
                answered = true;
                checkButton.disabled = true;
                answerInputElement.classList.add('correct');
                feedbackElement.textContent = '‚úì Richtig! Gut gemacht!';
                feedbackElement.classList.add('correct');
                
                // Karte flippen & weiter
                flashcardElement.style.cursor = 'pointer'; 
                setTimeout(flipCard, 500);
                nextButton.style.display = 'inline-block';
                answerInputElement.disabled = true;
                attemptCountElement.textContent = '';
                
            } else {
                // FALL 2: FALSCH
                failedAttempts++;
                
                answerInputElement.classList.add('incorrect');
                
                if (failedAttempts >= MAX_ATTEMPTS) {
                    // FALL 2a: Falsch und MAX_ATTEMPTS erreicht (Aufgeben)
                    answered = true;
                    checkButton.disabled = true;
                    feedbackElement.textContent = `‚úó Falsch. Maximale Versuche erreicht. Die korrekte Antwort war: "${card.back}"`;
                    feedbackElement.classList.add('incorrect');
                    
                    // Karte flippen & weiter
                    flashcardElement.style.cursor = 'pointer';
                    setTimeout(flipCard, 500);
                    nextButton.style.display = 'inline-block';
                    answerInputElement.disabled = true;
                    attemptCountElement.textContent = '';

                } else {
                    // FALL 2b: Falsch, aber weitere Versuche erlaubt
                    setTimeout(() => {
                        answerInputElement.classList.remove('incorrect');
                        answerInputElement.value = ''; 
                    }, 500);
                    
                    feedbackElement.textContent = `Falsch. Versuch ${failedAttempts} von ${MAX_ATTEMPTS} fehlgeschlagen. Achte auf die Gro√ü-/Kleinschreibung!`;
                    feedbackElement.classList.remove('correct');
                    feedbackElement.classList.add('incorrect');
                    
                    updateAttemptCount();
                }
            }
        }

        function nextCard() {
            currentCardIndex++;
            showCard();
        }

        function showCompletion() {
            document.querySelector('.input-section').style.display = 'none';
            document.querySelector('.card-container').style.display = 'none';
            progressTextElement.style.display = 'none';
            attemptCountElement.style.display = 'none';
            completionMessage.classList.add('show');
        }

        function restartGame() {
            currentCardIndex = 0;
            shuffleArray(flashcards); 
            document.querySelector('.input-section').style.display = 'block';
            document.querySelector('.card-container').style.display = 'block';
            progressTextElement.style.display = 'block';
            attemptCountElement.style.display = 'block';
            completionMessage.classList.remove('show');
            startGame();
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function startGame() {
            showCard();
            // Stellt sicher, dass die Klick-Logik nur bei "answered = true" funktioniert
            flashcardElement.removeEventListener('click', flipCard);
            flashcardElement.addEventListener('click', flipCard);
            
            // F√§ngt Enter-Taste ab
            answerInputElement.removeEventListener('keypress', handleKeypress);
            answerInputElement.addEventListener('keypress', handleKeypress);
        }
        
        function handleKeypress(e) {
             if (e.key === 'Enter' && !checkButton.disabled && !answerInputElement.disabled) {
                checkAnswer();
            }
        }


        // #######################################################
        // 5. INITIALISIERUNG
        // #######################################################
        
        window.onload = () => {
             renderMenu();
        }
    </script>
</body>
</html>
